# WMF produciton main release cluster specific values.
# These are kept out of the primary values.yaml just so that it is easier to use
# with local development.

app:
  flinkConfiguration:
    # The total memory available to the jobmanager and
    # taskmanager processes. This is the sum of on / off JVM heap memory,
    # JVM metaspace and JVM overhead.
    #
    # On containerized setups this should match the memory allocated to the
    # container.
    # See https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/config/#taskmanager-memory-process-size
    "jobmanager.memory.process.size": "1500m"
    "taskmanager.memory.process.size": "1500m"

  # TODO: might require tuning.
  # 1500m is the basline memory allocation used with the
  # YARN deployment of this job.
  jobManager:
    resource:
      memory: 1500m

  taskManager:
    resource:
      memory: 1500m

mesh:
  enabled: false

networkpolicy:
  egress:
    enabled: true
    dst_nets:
      # Allow schema.svc.{eqiad,codfw}.
      # TODO: When we deploy this to production wikikube, we should
      # bake the schema repo into the app image just like we do for eventgate-main.
      - cidr: 10.2.2.43/32 # schema.svc.eqiad.wmnet
        ports:
          - protocol: tcp
            port: 8190
          - protocol: tcp
            port: 443
      - cidr: 10.2.1.43/32 # schema.svc.codfw.wmnet
        ports:
          - protocol: tcp
            port: 8190
          - protocol: tcp
            port: 443
      # Allow api-ro
      - cidr: 10.2.2.22/32
        ports:
          - protocol: tcp
            port: 443
      - cidr: 10.2.1.22/32
        ports:
          - protocol: tcp
            port: 443
