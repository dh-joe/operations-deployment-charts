app:
  image: docker-registry.discovery.wmnet/repos/search-platform/cirrus-streaming-updater/consumer
  job:
    entryClass: org.wikimedia.discovery.cirrus.updater.consumer.ConsumerApplication

  taskManager:
    # NOTE: taskManager.replicas takes precedence over job.parallelism.
    # To increase default job parellism, we can increase this
    # and/or flinkConfiguration.taskmanager.numberOfTaskSlots accordingly.
    replicas: 5
    resource:
      cpu: 2

  config_files:
    app.config.yaml:
      elasticsearch-bulk-max-action-size: 9mb # 2 * 4mb + overhead
      elasticsearch-bulk-flush-max-size: 16mb # default (100mb) causes OOM
      elasticsearch-bulk-flush-max-actions: 800 # based on metrics for max-size

mesh:
  concurrency: 2 # https://phabricator.wikimedia.org/T353460#9437962
  resources:
    requests:
      cpu: 1
    limits:
      cpu: 1
