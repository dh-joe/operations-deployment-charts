resources:
  replicas: 1
  postgres:
    max_connections: 5

# Temporarily we will use envoy as a L4 tcp proxy until envoy's
# Postgres proxy filter is production ready
# https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/postgres_proxy_filter#config-network-filters-postgres-proxy
tcp_services_proxy:
  maps_postgres:
    # Basic TCP health checks
    # For more info: https://www.envoyproxy.io/docs/envoy/v1.23.12/api-v3/config/core/v3/health_check.proto#envoy-v3-api-msg-config-core-v3-healthcheck
    health_checks:
    - timeout: 5s
      interval: 1s
      unhealthy_threshold: 3
      initial_jitter: 1s
      healthy_threshold: 5
      tcp_health_check: {}
      always_log_health_check_failures: true
      event_log_path: "/dev/stdout"
    upstreams:
      # master node
      # - address: maps1009.eqiad.wmnet
      #   port: 5432
      # read replicas
      - address: maps1005.eqiad.wmnet
        port: 5432
      - address: maps1006.eqiad.wmnet
        port: 5432
      - address: maps1007.eqiad.wmnet
        port: 5432
      - address: maps1008.eqiad.wmnet
        port: 5432
      - address: maps1010.eqiad.wmnet
        port: 5432

tileCaching:
  enabled: true
  config:
    basepath: "staging-v0.0.1"
    bucket: "tegola-swift-staging-container"

config:
  public:
    TEGOLA_BROKER_URL: "kafka://10.64.16.146:9092" # kafka-test1006.eqiad.wmnet
    TEGOLA_QUEUE_NAME: "tegola-staging"

tilePregeneration:
  cronJobEnabled: false
  parallelism: 1

kafka:
  allowed_clusters:
    - test-eqiad
