service:
  deployment: production
  # HTTP port 30892 in chart values.yaml
  routing_tag: eventstreams

tls:
  enabled: true
  image_version: 1.13.1-1
  # HTTPS port 4892 in chart values.yaml
  telemetry:
    enabled: true

resources:
  replicas: 8

main_app:
  name: eventstreams
  version: 2020-03-23-173308-production

  requests:
    cpu: 200m
    memory: 500Mi
  limits:
    cpu: 1500m
    memory: 1000Mi

  # This is the Puppet CA cert.
  kafka_ca_cert: |-
    -----BEGIN CERTIFICATE-----
    MIIFXzCCA0egAwIBAgIUQPBPwrOR622kzKx6kBuEsU5OxV0wDQYJKoZIhvcNAQEL
    BQAwKzEpMCcGA1UEAwwgUHVwcGV0IENBOiBwYWxsYWRpdW0uZXFpYWQud21uZXQw
    HhcNMTkxMTA0MTIwOTM4WhcNMjkxMTAxMTIwOTM4WjArMSkwJwYDVQQDDCBQdXBw
    ZXQgQ0E6IHBhbGxhZGl1bS5lcWlhZC53bW5ldDCCAiIwDQYJKoZIhvcNAQEBBQAD
    ggIPADCCAgoCggIBAMMi6NogAUaQaMhR7iQfPX1hQAzHUqnIeHxaPp/JVyPxTEBy
    sjfmQsO3dkr/eRPaS+6VIljA7lc9lvbwVkUb3DUc/lmqrz0xipeWj0HvAG3Lt+Vw
    rwgQkQrtwEntIyWhVC3sVrBaPMqz42ybh+QIWWdDBR1H3LpURi1Aidd+P6zCjPS/
    9/wiujXNwrqe006JCv3M0kZqkz/0YqBxMQIn1mzw+xaZJ0pn7LJL3nq2iidS+zgO
    zuXU/Sf7yZVG6xKn/AXBmgu1NEkYJyyBjyHIXI71AW49jOSTds9NZ6kBnJOboTZC
    52Wg/1QjREjcDdXsApXDXCEtQZRCIEMK3BvRgeEcARargOgcqcPKy0QYk5Ch2BkZ
    PkKDI6DO/7mmkFA0Xs7D7KVU+wyzdMxHya+l4vEblE66imSLhA4cSJea/AmaYRBe
    SXVR0duNwvs8rq8kW3bB7lrqgd6D6pF9/OHwI3gPNDtc5Eq1tD/R1FK4VUIq1m24
    8ib0abtirnROtMuS7GCdjDrLFJb3eO+fgkpAsW3Ga7taTBJ4AqbgoxB2SXuej0bz
    Wfe2hk1tzJjY6qSlo/nbtRf+eHq75tqTK1ybcL5YUlLV2dCnUgho9porL+ms5+ay
    b4T0DGRYg+xxAUali4eLmA2PETuZILPktJCQumhP7yCAerWfNjKgZXreAsldAgMB
    AAGjezB5MA8GA1UdEwEB/wQFMAMBAf8wNwYJYIZIAYb4QgENBCoWKFB1cHBldCBS
    dWJ5L09wZW5TU0wgSW50ZXJuYWwgQ2VydGlmaWNhdGUwDgYDVR0PAQH/BAQDAgEG
    MB0GA1UdDgQWBBRZ5IYwfgKvDQCmdO2a9g4XrmyuujANBgkqhkiG9w0BAQsFAAOC
    AgEAhx2QGcCOlGIRKWmnG0zbdpOVoy1L9Bjb3EuCkGWOue1cod2BINU+65PDmMMl
    MTvoExKJI/fbs8ADGaVDAeyt2LHiOLbp8sRn6ThFmhnQN2uU61zvAwneVnCApDFO
    0+gEok/mNtD4FLKP/4OhHfcSgmw/3M3I04Nrm3ssu37jCss7ZnZ5LrVZBzT41ulc
    UZ1Y1JPSLFvdd8kA053oR3GDmchOIqWXkPBo6XjvE/dVGdoUSeWdNIAVmFvZTc1I
    /KGhkw0ll3bNIHmWRWPjRR5QmHTmJTgoxIXWZcr2vRLh3Mjyq1mLw4YEjvYPLtIR
    tBGswBpc7eY8exDDkA1tJhxKS3DA0JkGm2wbAfQU2vim54VQ09J/8wCiTsUxNT5U
    E2UwAW+fbLghjItFULr7B09usEXo6Qoiq3QGsJal1ksfjIxA8l0GY7v8l4io2Hsa
    nT6EssrHNxEEZQxY4tBp1c+qS8IG7ILyAAiwtLFRtjcp2rQRvZLDSZ7FJivrqOjY
    h4us+rUVI/KJfaKHrh70Q5ufj+dOZFBmpLgupzxP1aWNRtFHNiJqYIVcAjvba3dv
    SaEqoNHJ2+KytzdcT9HzY/ywvd0tUFBJCCtuGpwVtimHYXkInwFfP4zmFZmsETld
    Jl3aYuLUirKWSp+dQm8ikFCJ2gGaB8WHQWzIswFEw08vpAM=
    -----END CERTIFICATE-----

  conf:
    kafka:
      metadata.broker.list: kafka-main1001.eqiad.wmnet:9093,kafka-main1002.eqiad.wmnet:9093,kafka-main1003.eqiad.wmnet:9093
      queued.max.messages.kbytes: 32768
      fetch.message.max.bytes: 8388608
      queued.min.messages: 1000
      statistics.interval.ms: 60000
      # Enable Kafka consumer TLS (no authentication, just encryption).
      security.protocol: ssl
      ssl.ca.location: /etc/eventstreams/kafka_ca.crt.pem

    # List of stream name (routes) and their constituent topics.
    # This is used to choose which topics are exposed, as well as for
    # generating the OpenAPI spec documentation.
    streams:

      test:
        description: |-
          A test event stream. A new event is posted about once a minute.
          Schema: https://github.com/wikimedia/mediawiki-event-schemas/tree/master/jsonschema/test/event
        topics:
          - eqiad.test.event
          - codfw.test.event

      page-create:
        description: |-
          Mediawiki Page create events. This page create stream is just the first revision create
          event for each page. As such, it reuses the mediawiki/revision/create schema.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/revision/create/latest
        topics:
          - eqiad.mediawiki.page-create
          - codfw.mediawiki.page-create

      page-delete:
        description: |-
          Mediawiki Page delete events.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/page/delete/latest
        topics:
          - eqiad.mediawiki.page-delete
          - codfw.mediawiki.page-delete

      page-move:
        description: |-
          Mediawiki Page move (rename) events.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/page/move/latest
        topics:
          - eqiad.mediawiki.page-move
          - codfw.mediawiki.page-move

      page-undelete:
        description: |-
          Mediawiki Page un-delete events.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/page/undelete/latest
        topics:
          - eqiad.mediawiki.page-undelete
          - codfw.mediawiki.page-undelete

      page-properties-change:
        description: |-
          Mediawiki Page Properties change events.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/page/properties-change/latest
        topics:
          - eqiad.mediawiki.page-properties-change
          - codfw.mediawiki.page-properties-change

      page-links-change:
        description: |-
          Mediawiki Page Links change events.
          Schema: https://schema.wikimedia.org/repositories/primary/jsonschema/mediawiki/page/links-change/latest
        topics:
          - eqiad.mediawiki.page-links-change
          - codfw.mediawiki.page-links-change

      recentchange:
        description: |-
          Mediawiki RecentChanges feed.
          Schema: https://github.com/wikimedia/mediawiki-event-schemas/tree/master/jsonschema/mediawiki/recentchange
        topics:
          - eqiad.mediawiki.recentchange
          - codfw.mediawiki.recentchange

      revision-create:
        description: |-
          Mediawiki Revision create events.
          Schema: https://github.com/wikimedia/mediawiki-event-schemas/tree/master/jsonschema/mediawiki/revision/create
        topics:
          - eqiad.mediawiki.revision-create
          - codfw.mediawiki.revision-create

      revision-score:
        description: |-
          Mediawiki Revision Score feed. Every new revision in an ORES enabled wiki should have a
          revision-score event. This schema is structured differnetly than ORES API results, as
          event schemas should map well into RDBMS / SQL environments where columns must be
          strongly typed.
          NOTE: Only the most commonly used ORES model scores are included in each event
          (the ones returned by https://ores.wikimedia.org/v3/precache).
          Schema: https://github.com/wikimedia/mediawiki-event-schemas/tree/master/jsonschema/mediawiki/revision/score
        topics:
          - eqiad.mediawiki.revision-score
          - codfw.mediawiki.revision-score
