main_app:

  version: 1.15.0

  telemetry_port: 1667

  jwt:
    enabled: true
    issuer: https://meta.wikimedia.org

  ratelimiter:
    enabled: true
    version: 1.5.1
    log_level: debug
    redis_host: localhost
    redis_port: 6379
    redis_pass: ""

  strip_api_cookies: true

  domains:
    - api.wikimedia.org
    - api.wikimedia.org:*

  access_log:
    type: eventgate
    image_version: 1.5.3-0
    debug: false
    tls: true
    event_service:
      host: eventgate-analytics.discovery.wmnet
      port: 4592
      path: /v1/events?hasty=true

  endpoints:
    mwapi_cluster:
      tls: true
      type: STRICT_DNS
      hosts:
        api-rw.discovery.wmnet: 443
      debug_hosts:
        mwdebug1001.eqiad.wmnet: 443
        mwdebug1002.eqiad.wmnet: 443
    restbase_cluster:
      type: LOGICAL_DNS
      hosts:
        restbase.discovery.wmnet: 7231
    appserver_cluster:
      tls: true
      type: STRICT_DNS
      hosts:
        appservers-rw.discovery.wmnet: 443
      debug_hosts:
        mwdebug1001.eqiad.wmnet: 443
        mwdebug1002.eqiad.wmnet: 443

  readiness_probe:
    httpGet:
      path: /healthz
      port: 8087
      scheme: HTTPS

nutcracker:
  enabled: true
  servers:
    - rdb1005.eqiad.wmnet:6379:1 "cp-1"
    - rdb1009.eqiad.wmnet:6379:1 "cp-2"

networkpolicy:
  egress:
    enabled: true
    dst_nets:
    - cidr: 10.2.2.1/32 # appservers-rw.discovery.wmnet LVS endpoint (eqiad)
      ports:
      - protocol: tcp
        port: 443
      - protocol: tcp
        port: 80
    - cidr: 10.2.1.1/32 # appservers-rw.discovery.wmnet LVS endpoint (codfw)
      ports:
      - protocol: tcp
        port: 443
      - protocol: tcp
        port: 80
    - cidr: 10.2.2.22/32 # api-rw.discovery.wmnet LVS endpoint (eqiad)
      ports:
      - protocol: tcp
        port: 443
      - protocol: tcp
        port: 80
    - cidr: 10.2.1.22/32 # api-rw.discovery.wmnet LVS endpoint (codfw)
      ports:
      - protocol: tcp
        port: 443
      - protocol: tcp
        port: 80
    - cidr: 10.192.16.122/32 # rdb2003
      ports:
      - protocol: tcp
        port: 6379
    - cidr: 10.192.32.133/32 # rdb2005
      ports:
      - protocol: tcp
        port: 6379
    - cidr: 10.64.0.24/32 # rdb1005
      ports:
      - protocol: tcp
        port: 6379
    - cidr: 10.64.16.76/32 # rdb1009
      ports:
      - protocol: tcp
        port: 6379
    - cidr: 10.2.2.17/32 # restbase.discovery.wmnet (eqiad)
      ports:
      - protocol: tcp
        port: 7231
    - cidr: 10.2.2.45/32 # eventgate-main.svc.eqiad.wmnet
      ports:
        - protocol: tcp
          port: 4492

service:
  deployment: production
  port:
    nodePort: 8087

tls:
  enabled: true

# Only used by ratelimiter for metrics - envoy uses prometheus native metrics
monitoring:
  enabled: true
  image_version: 0.0.5
