docker:
  registry: docker-registry.discovery.wmnet
app:
  port: 6927
  requests:
    cpu: 100m
    memory: 200Mi
  limits:
    cpu: 1
    memory: 400Mi
  version: 2023-07-06-165132-production
  image: repos/mediawiki/services/ipoid
monitoring:
  enabled: false
  image_version: latest
resources:
  replicas: 1
service:
  deployment: production

config:
  public:
    MYSQL_HOST: m5-master.eqiad.wmnet
    MYSQL_PORT: 3306
    MYSQL_DATABASE: ipoid
    MYSQL_RW_USER: ipoid_rw
    MYSQL_RO_USER: ipoid_ro
    TMPDIR: "/tmp/ipoid"
  private: {}
cronjobs:
  dailyUpdates:
    enabled: false
    command:
      - ./main.sh
      - "--updatedb"
      - "true"
      - "--debug"
      - "false"
    schedule: "0 0 1 11 *"  # 1st of Nov every year
    concurrency: Forbid
    backoffLimit: 2
    volumeMounts:
      - mountPath: "/tmp/ipoid"
        name: tmp-ipoid-memory
    resources:
      requests:
        cpu: 500m
        memory: 11Gi
      limits:
        cpu: 1
        memory: 12Gi
    volumes:
      - name: tmp-ipoid-memory
        emptyDir:
          medium: Memory
          sizeLimit: "10Gi"
  initialImport:
    enabled: false
    command:
      - ./main.sh
      - "--init"
      - "true"
      - "--debug"
      - "true"
    schedule: "0 0 1 11 *" # 1st of Nov every year
    concurrency: Forbid
    backoffLimit: 1
    volumeMounts:
      - mountPath: "/tmp/ipoid"
        name: tmp-ipoid-memory
    resources:
      requests:
        cpu: 500m
        memory: 11Gi
      limits:
        cpu: 1
        memory: 12Gi
    volumes:
      - name: tmp-ipoid-memory
        emptyDir:
          medium: Memory
          sizeLimit: "10Gi"
networkpolicy:
  egress:
    enabled: true
ingress:
  enabled: true
mesh:
  enabled: true
  certmanager:
    enabled: true
# Allow to reach out to WMF MariaDB m5 section
mariadb:
  egress:
    sections: ["m5"]
