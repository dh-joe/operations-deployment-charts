
docker:
  registry: docker-registry.wikimedia.org
  pull_policy: IfNotPresent
  image: wikimedia/wikidata-query-flink-rdf-streaming-updater
  version: 2021-07-26-125114-production

main_app:
  replicas: 1
  requests:
    cpu: 1000m
    memory: 1600M
  limits:
    cpu: 1000m
    memory: 1600M
  config:
    task_slots: 4
    job_manager_mem : 1600m
    task_manager_mem: 2048m
    parallelism: 12
    swift_auth_url: https://thanos-swift.discovery.wmnet/auth/v1.0
    swift_username: wdqs:flink

task_manager:
  replicas: 3
  requests:
    cpu: 4000m
    memory: 2048M
  limits:
    cpu: 4000m
    memory: 2048M

service:
  deployment: production
  port:
    port: 14007 # the port number desired to be exposed to the cluster
config:
  public: {}
  private:
    swift_api_key: some_secret_key
tls:
  enabled: true
  public_port: 4007
  upstream_timeout: "180.0s"
  certs:
    cert: "snakeoil"
    key: "snakeoil"
discovery:
  listeners:
    - mwapi-async
    - schema
networkpolicy:
  egress:
    enabled: true
    dst_nets:
      - cidr: 10.2.2.54/32 # thanos-swift.svc.eqiad.wmnet
        ports:
        - port: 443
          protocol: tcp
      - cidr: 10.2.1.54/32 # thanos-swift.svc.codfw.wmnet
        ports:
        - port: 443
          protocol: tcp
      - cidr: 10.64.0.117/32 # kubemaster1001.eqiad.wmnet
        ports:
        - port: 6443
          protocol: tcp
      - cidr: 10.64.32.116/32 # kubemaster1002.eqiad.wmnet
        ports:
        - port: 6443
          protocol: tcp
      - cidr: 10.192.0.56/32 # kubemaster2001.codfw.wmnet
        ports:
        - port: 6443
          protocol: tcp
      - cidr: 10.192.16.48/32 # kubemaster2002.codfw.wmnet
        ports:
        - port: 6443
          protocol: tcp
      - cidr: 10.64.16.203/32 # kubestagemaster1001.eqiad.wmnet
        ports:
        - port: 6443
          protocol: tcp
      - cidr: 10.192.48.10/32 # kubestagemaster2001.codfw.wmnet
        ports:
        - port: 6443
          protocol: tcp
      # FIXME: drop this once wmf.networkpolicy.egress.kafka works properly
      - cidr: 10.64.0.11/32   # kafka1001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.16.41/32   # kafka1002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.32.127/32   # kafka1003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:101:10:64:0:11/128   # kafka1001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:102:10:64:16:41/128   # kafka1002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:103:10:64:32:127/128   # kafka1003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
            # main-codfw:
      - cidr: 10.192.0.139/32   # kafka2001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.16.169/32   # kafka2002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.32.150/32   # kafka2003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.0.200/32   # kafka-main1001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.16.37/32   # kafka-main1002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.32.90/32   # kafka-main1003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.48.30/32   # kafka-main1004
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.64.48.31/32   # kafka-main1005
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.0.17/32   # kafka-main2001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.16.8/32   # kafka-main2002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.32.136/32   # kafka-main2003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.48.38/32   # kafka-main2004
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 10.192.48.46/32   # kafka-main2005
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:101:10:192:0:139/128   # kafka2001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:102:10:192:16:169/128   # kafka2002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:103:10:192:32:150/128   # kafka2003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:101:10:64:0:200/128   # kafka-main1001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:102:10:64:16:37/128   # kafka-main1002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:103:10:64:32:90/128   # kafka-main1003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:107:10:64:48:30/128   # kafka-main1004
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:861:107:10:64:48:31/128   # kafka-main1005
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:101:10:192:0:17/128   # kafka-main2001
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:102:10:192:16:8/128   # kafka-main2002
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:103:10:192:32:136/128   # kafka-main2003
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:104:10:192:48:38/128   # kafka-main2004
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
      - cidr: 2620:0:860:104:10:192:48:46/128   # kafka-main2005
        ports:
          - protocol: tcp
            port: 9092
          - protocol: tcp
            port: 9093
