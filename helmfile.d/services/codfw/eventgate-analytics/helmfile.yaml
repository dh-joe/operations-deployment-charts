repositories:
  - name: stable
    url: https://releases.wikimedia.org/charts/

helmDefaults:
  tillerNamespace: eventgate-analytics
  verify: false
  wait: true
  timeout: 600
  recreatePods: false
  force: false

releases:

  - name: production
    namespace: eventgate-analytics
    chart: stable/eventgate
    missingFileHandler: Warn
    values:
    - "values.yaml"
    - "private/secrets.yaml"
    wait: true
    hooks:
    - events: ["prepare"]
      command: "helmfile_log_sal"
      args: [ "{{`{{.HelmfileCommand}}`}}", "[CODFW] Ran '{{`{{.HelmfileCommand}}`}}' command on namespace '{{`{{.Release.Namespace}}`}}' for release '{{`{{.Release.Name}}`}}' ."]

  - name: canary
    namespace: eventgate-analytics
    chart: stable/eventgate
    missingFileHandler: Warn
    values:
    - "values.yaml"
    - "values-canary.yaml"
    - "private/secrets.yaml"
    wait: true
    hooks:
    - events: ["prepare"]
      command: "helmfile_log_sal"
      args: [ "{{`{{.HelmfileCommand}}`}}", "[CODFW] Ran '{{`{{.HelmfileCommand}}`}}' command on namespace '{{`{{.Release.Namespace}}`}}' for release '{{`{{.Release.Name}}`}}' ."]

  # TODO: Destroy and remove this release after LVS is migrated
  # to using the production release's Service nodePort.
  # https://phabricator.wikimedia.org/T245203
  - name: analytics
    namespace: eventgate-analytics
    chart: stable/eventgate
    missingFileHandler: Warn
    values:
    - "values.yaml"
    - "private/secrets.yaml"
    wait: true
    hooks:
    - events: ["prepare"]
      command: "helmfile_log_sal"
      args: [ "{{`{{.HelmfileCommand}}`}}", "[CODFW] Ran '{{`{{.HelmfileCommand}}`}}' command on namespace '{{`{{.Release.Namespace}}`}}' for release '{{`{{.Release.Name}}`}}' ."]
